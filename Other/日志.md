日志记录是系统可观测性的核心手段，需根据场景合理设计。
### **一、后端开发需记录日志的场景**
1. **错误与异常处理**  
   - **场景**：数据库操作失败、未处理的异常、第三方服务调用异常（如支付接口超时）、API 参数校验失败。  
   - **作用**：快速定位问题根源，避免服务崩溃或数据不一致。  
   - **示例**：  
```python
try:
	user = User.get(id=user_id)
except DatabaseError as e:
	logger.error(f"Database query failed: {e}", exc_info=True)  # 记录异常堆栈
raise HTTPException(status_code=500)
```

2. **请求处理跟踪**  
   - **场景**：记录每个 HTTP 请求的元数据（路径、方法、客户端 IP、响应状态码、处理时间）。  
   - **作用**：监控接口性能，识别慢请求或异常流量（如高频访问）。  
   - **工具**：使用中间件（如 Express.js 的 `morgan`、Django 的日志中间件）自动记录 [[5]]。

3. **关键业务逻辑**  
   - **场景**：用户注册、支付成功、数据变更等核心操作。  
   - **作用**：满足审计要求（如 GDPR、金融监管），提供操作追溯能力。  
   - **示例**：  
```java
public void processPayment(PaymentRequest request) {
	logger.info("Payment initiated - User: {}, Amount: {}", request.userId(), request.amount());
// 业务逻辑
	logger.info("Payment completed - Transaction ID: {}", transactionId);
}
```

4. **安全事件**  
   - **场景**：登录失败、权限校验失败、敏感数据访问尝试。  
   - **作用**：识别潜在攻击（如暴力破解、SQL 注入），但需避免记录敏感信息（如密码）[[7]]。
### **二、前端开发需记录日志的场景**
1. **用户交互与行为**  
   - **场景**：按钮点击、页面跳转、表单提交、功能使用频率。  
   - **作用**：分析用户体验，优化产品设计（需用户同意以符合隐私法规）。  
   - **工具**：Google Analytics、Mixpanel 或自定义事件日志 [[2]]。

2. **客户端错误与异常**  
   - **场景**：JavaScript 运行时错误、API 请求失败、渲染错误（如 React 的 `componentDidCatch`）。  
   - **作用**：捕获浏览器兼容性问题或接口异常。  
   - **示例**：  
     ```javascript
     window.addEventListener('error', (event) => {
         sendToLogServer({
             message: event.message,
             stack: event.error.stack,
             userAgent: navigator.userAgent
         });
     });
     ```

3. **性能监控**  
   - **场景**：页面加载时间、资源加载耗时、关键操作响应延迟。  
   - **工具**：使用 `Performance API` 或工具（如 Lighthouse、New Relic）[[6]]。

4. **API 请求追踪**  
   - **场景**：记录请求 URL、参数、响应状态码、耗时。  
   - **作用**：与后端日志关联，排查协作问题（如超时、数据格式错误）[[8]]。

### **三、通用日志实践**
1. **日志分级**  
   - **级别**：DEBUG（开发）、INFO（业务关键）、WARN（可恢复问题）、ERROR（严重错误）、FATAL（系统崩溃）。  
   - **环境差异**：生产环境关闭 DEBUG 日志以提升性能 [[7]][[10]]。

2. **结构化日志**  
   - **格式**：使用 JSON 或键值对，包含时间戳、服务名称、请求 ID、用户 ID 等上下文。  
   - **优势**：便于日志分析工具（如 ELK、Splunk）聚合 [[3]][[5]]。

3. **敏感信息过滤**  
   - **避免记录**：密码、信用卡号、JWT Token 等。  
   - **处理方式**：配置脱敏规则（如替换为 `***`）[[9]][[10]]。

4. **日志聚合与告警**  
   - **工具链**：后端用 ELK、Datadog；前端用 Sentry、LogRocket（支持录屏）。  
   - **告警规则**：ERROR 日志触发通知，高频 5xx 错误自动扩容 [[5]][[6]]。
### **四、不推荐记录日志的场景**
- **高频冗余日志**：如循环内逐条记录 DEBUG 信息（影响性能）。  
- **用户隐私数据**：即使加密也可能违反 GDPR 等法规。  
- **前端源码细节**：避免暴露业务逻辑（如反爬虫策略）[[4]][[9]]。
### **总结**
合理记录日志需平衡**信息量、性能与安全**：  
- 后端聚焦系统稳定性与业务审计，前端侧重用户体验与错误追踪。  
- 结合工具链（如 OpenTelemetry）实现全链路监控，提升运维效率 [[1]][[6]][[10]]。

## Linux 日志

Linux 系统拥有强大的日志功能，能够记录系统和应用程序的各种运行信息，帮助管理员监控系统状态、诊断问题并进行故障排除。

**常见日志文件：**

- `/var/log/messages`：记录系统的常规信息和错误，是诊断系统问题的首要日志文件。
- `/var/log/secure`：记录与安全相关的事件，如用户认证、授权等操作。
- `/var/log/cron`：记录定时任务（如 cron 作业）的执行情况。
- `/var/log/dmesg`：记录系统启动时内核产生的消息，可使用 `dmesg` 命令查看。
- `/var/log/boot.log`：记录系统引导过程中的事件。
- `/var/log/maillog`：记录邮件相关的信息。
- `/var/log/btmp`：记录失败的登录尝试，可使用 `lastb` 命令查看。
- `/var/log/wtmp`：永久记录所有用户的登录、注销信息，以及系统的启动、重启、关机事件，可使用 `last` 命令查看。
- `/var/log/utmp`：记录当前已登录的用户信息，可使用 `who`、`w`、`users` 等命令查看。
- `/var/log/lastlog`：记录系统中所有用户最后一次登录时间的日志，可使用 `lastlog` 命令查看。

**日志服务：**

大多数 Linux 发行版使用 `syslog` 或其变体（如 `rsyslog`）作为日志守护进程，负责收集和管理日志信息。配置文件通常位于 `/etc/rsyslog.conf`，可在其中设置不同服务和日志级别的记录方式。

**日志级别：**

日志信息根据严重程度分为不同级别，包括：

- `emerg`：紧急情况，系统不可用。
- `alert`：需要立即采取措施的问题。
- `crit`：严重情况，可能影响系统功能。
- `err`：错误信息。
- `warning`：警告信息。
- `notice`：普通但重要的情况。
- `info`：一般信息。
- `debug`：调试信息。

**日志分析技巧：**

- 使用 `grep` 搜索特定关键词，例如查找失败的登录尝试：
    
    bash
    
    复制编辑
    
    `grep "Failed password" /var/log/secure`
    
- 使用 `awk` 提取特定字段，例如统计尝试登录的 IP 地址：
    
    bash
    
    复制编辑
    
    `grep "Failed password" /var/log/secure | awk '{print $11}' | sort | uniq -c | sort -nr`
    
- 使用 `tail -f` 实时监控日志文件的最新输出：
    
    bash
    
    复制编辑
    
    `tail -f /var/log/messages`
    

通过熟练使用这些日志文件和分析技巧，管理员可以有效地监控系统运行状态，及时发现并解决潜在问题。